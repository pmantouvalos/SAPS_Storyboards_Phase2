<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>SAPS Storyboards Viewer</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
</head>

<body>

  <!-- CINEMATIC LOADING SCREEN -->
  <div id="loader" class="loader-screen">
    <div class="loader-inner">
      <img src="logo.svg" class="loader-logo" />

      <div class="loader-ring"></div>
      <div class="loader-text">Loading SAPS Diagram…</div>
    </div>
  </div>

  <!-- TOP TOOLBAR -->
  <div class="toolbar fade-in">
    <button id="toggleThemeBtn">Light mode</button>
    <button id="resetViewBtn">Reset view</button>
    <a href="sapsfinalstoryboards.drawio.png" download>Download PNG</a>
    <small>Scroll = zoom · Drag = pan</small>
  </div>

  <!-- MAIN DIAGRAM AREA -->
  <div class="container" id="container">
    <div class="viewport" id="viewport">
      <div class="image-wrapper" id="imageWrapper">
        <img
          id="diagramImage"
          src="sapsfinalstoryboards.drawio.png"
          alt="SAPS Storyboards Diagram"
        />
      </div>
    </div>
  </div>

  <!-- HINT MESSAGE -->
  <div class="hint fade-in-slow">
    Χρησιμοποίησε το ροδάκι για zoom και drag με το ποντίκι για μετακίνηση.
  </div>

  <!-- CREDITS -->
  <div class="credits fade-in-slower">
    Made by our team for the SAPS Project.<br />
    Chania, 2025.
  </div>

  <!-- JAVASCRIPT -->
  <script>
    (function () {
      const container = document.getElementById("container");
      const viewport = document.getElementById("viewport");
      const imageWrapper = document.getElementById("imageWrapper");
      const img = document.getElementById("diagramImage");
      const toggleThemeBtn = document.getElementById("toggleThemeBtn");
      const resetViewBtn = document.getElementById("resetViewBtn");
      const loader = document.getElementById("loader");

      let scale = 1,
        minScale = 0.05,
        maxScale = 6,
        translateX = 0,
        translateY = 0;

      let isDragging = false;
      let dragStartX = 0,
        dragStartY = 0,
        startTranslateX = 0,
        startTranslateY = 0;

      function applyTransform() {
        imageWrapper.style.transform =
          `translate(${translateX}px, ${translateY}px) scale(${scale})`;
      }

      viewport.addEventListener(
        "wheel",
        function (e) {
          e.preventDefault();

          const rect = viewport.getBoundingClientRect();
          const offsetX = e.clientX - rect.left;
          const offsetY = e.clientY - rect.top;

          const zoomFactor = e.deltaY < 0 ? 1.12 : 0.88;
          const newScale = Math.min(
            maxScale,
            Math.max(minScale, scale * zoomFactor)
          );

          const ratio = newScale / scale;
          translateX = offsetX - (offsetX - translateX) * ratio;
          translateY = offsetY - (offsetY - translateY) * ratio;

          scale = newScale;
          applyTransform();
        },
        { passive: false }
      );

      viewport.addEventListener("mousedown", function (e) {
        isDragging = true;
        container.classList.add("dragging");
        dragStartX = e.clientX;
        dragStartY = e.clientY;
        startTranslateX = translateX;
        startTranslateY = translateY;
      });

      window.addEventListener("mousemove", function (e) {
        if (!isDragging) return;
        translateX = startTranslateX + (e.clientX - dragStartX);
        translateY = startTranslateY + (e.clientY - dragStartY);
        applyTransform();
      });

      window.addEventListener("mouseup", function () {
        isDragging = false;
        container.classList.remove("dragging");
      });

      viewport.addEventListener("mouseleave", function () {
        isDragging = false;
        container.classList.remove("dragging");
      });

      function resetView() {
        const vw = viewport.clientWidth;
        const vh = viewport.clientHeight;
        const iw = img.naturalWidth;
        const ih = img.naturalHeight;

        const fitScale = Math.min(vw / iw, vh / ih);
        scale = Math.min(1, Math.max(minScale, fitScale));

        const displayW = iw * scale;
        const displayH = ih * scale;
        translateX = (vw - displayW) / 2;
        translateY = (vh - displayH) / 2;

        applyTransform();
      }

      img.addEventListener("load", () => {
        resetView();
        setTimeout(() => {
          loader.classList.add("hidden");
        }, 400);
      });

      resetViewBtn.addEventListener("click", resetView);

      toggleThemeBtn.addEventListener("click", function () {
        const isLight = document.body.classList.toggle("light");
        toggleThemeBtn.textContent = isLight ? "Dark mode" : "Light mode";
      });
    })();
  </script>
</body>
</html>
